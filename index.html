<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Parte de Mantenimiento</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      background-color: #f9f9f9;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    form {
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .grupo {
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    textarea {
      resize: vertical;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #aaa;
      padding: 6px;
      text-align: left;
    }

    th {
      background-color: #eee;
    }

    #firmaCanvas {
      width: 100%;
      height: 150px;
      border: 1px solid #000;
      touch-action: none;
    }

    .botones {
      text-align: center;
      margin-top: 15px;
    }

    .botones button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
    }

    .botones button:hover {
      background-color: #0056b3;
    }

    /* Salto de p√°gina para impresi√≥n */
    @media print {
      .salto-pagina {
        page-break-before: always;
      }
    }
  </style>
</head>
<body>
  <h1>Parte de Mantenimiento</h1>
  <form id="formulario">
    <!-- Primera p√°gina -->
    <div class="grupo">
      <label>Fecha</label>
      <input type="date" name="fecha" required>
    </div>
    <div class="grupo">
      <label>Hora de Inicio</label>
      <input type="time" name="hora_inicio" required>
    </div>
    <div class="grupo">
      <label>Hora de Fin</label>
      <input type="time" name="hora_fin" required>
    </div>
    <div class="grupo">
      <label>Tipo de Mantenimiento</label>
      <select name="tipo" required>
        <option value="Preventivo">Preventivo</option>
        <option value="Correctivo">Correctivo</option>
        <option value="Urgente">Urgente</option>
      </select>
    </div>
    <div class="grupo">
      <label>Sector</label>
      <input type="text" name="sector" required>
    </div>
    <div class="grupo">
      <label>Ubicaci√≥n</label>
      <input type="text" name="ubicacion" required>
    </div>
    <div class="grupo">
      <label>Descripci√≥n de la Tarea Realizada</label>
      <textarea rows="10" name="descripcion" required></textarea>
    </div>

    <!-- Salto de p√°gina para impresi√≥n -->
    <div class="salto-pagina"></div>

    <!-- Segunda p√°gina (dorso) -->
    <h2>T√©cnicos</h2>
    <div class="grupo">
      <label>T√©cnico 1 (Legajo)</label>
      <input type="text" name="tecnico1">
    </div>
    <div class="grupo">
      <label>T√©cnico 2 (Legajo)</label>
      <input type="text" name="tecnico2">
    </div>
    <div class="grupo">
      <label>T√©cnico 3 (Legajo)</label>
      <input type="text" name="tecnico3">
    </div>

    <h2>Materiales Utilizados</h2>
    <table>
      <thead>
        <tr>
          <th>Material</th>
          <th>Cantidad</th>
        </tr>
      </thead>
      <tbody id="materialesBody">
        <tr>
          <td><input type="text" name="material[]"></td>
          <td><input type="number" name="cantidad[]" min="1"></td>
        </tr>
      </tbody>
    </table>
    <button type="button" onclick="agregarMaterial()">Agregar Material</button>

    <h2>Firma del Responsable</h2>
    <canvas id="firmaCanvas"></canvas>
    <div class="botones">
      <button type="button" onclick="limpiarFirma()">Limpiar Firma</button>
      <button type="button" onclick="enviarWhatsApp()">Enviar por WhatsApp</button>
      <button type="button" onclick="descargarPDF()">Descargar PDF</button>
    </div>
  </form>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Firma en canvas
    const canvas = document.getElementById("firmaCanvas");
    const ctx = canvas.getContext("2d");
    let dibujando = false;

    const iniciarDibujo = (e) => {
      dibujando = true;
      ctx.beginPath();
      const rect = canvas.getBoundingClientRect();
      ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
    };

    const dibujar = (e) => {
      if (!dibujando) return;
      const rect = canvas.getBoundingClientRect();
      ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
      ctx.stroke();
    };

    const terminarDibujo = () => {
      dibujando = false;
      ctx.closePath();
    };

    canvas.addEventListener("mousedown", iniciarDibujo);
    canvas.addEventListener("mousemove", dibujar);
    canvas.addEventListener("mouseup", terminarDibujo);
    canvas.addEventListener("touchstart", (e) => iniciarDibujo(e.touches[0]));
    canvas.addEventListener("touchmove", (e) => {
      dibujar(e.touches[0]);
      e.preventDefault();
    });
    canvas.addEventListener("touchend", terminarDibujo);

    function limpiarFirma() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function agregarMaterial() {
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td><input type="text" name="material[]"></td>
        <td><input type="number" name="cantidad[]" min="1"></td>
      `;
      document.getElementById("materialesBody").appendChild(fila);
    }

    function enviarWhatsApp() {
      const form = document.forms["formulario"];
      const datos = new FormData(form);
      let mensaje = "üõ† *Parte de Mantenimiento*%0A";

      for (let [clave, valor] of datos.entries()) {
        if (clave !== "material[]" && clave !== "cantidad[]") {
          mensaje += `*${clave.replace("_", " ")}:* ${valor}%0A`;
        }
      }

      const materiales = datos.getAll("material[]");
      const cantidades = datos.getAll("cantidad[]");
      if (materiales.length) {
        mensaje += "*Materiales:*%0A";
        materiales.forEach((mat, i) => {
          if (mat) mensaje += `- ${mat}: ${cantidades[i]}%0A`;
        });
      }

      const url = `https://wa.me/?text=${mensaje}`;
      window.open(url, "_blank");
    }

    async function descargarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.html(document.getElementById("formulario"), {
        callback: function (pdf) {
          pdf.save("parte_mantenimiento.pdf");
        },
        x: 10,
        y: 10,
        width: 180,
        windowWidth: 800
      });
    }
  </script>
</body>
</html>

